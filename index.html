<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Travel Budget</title>
  <link rel="icon" href="/favicon.ico">

  <!-- Supabase JS (UMD) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<style>
    /* =========================
       Design Tokens
       ========================= */

    :root{
      /* Light defaults */
      --bg:#f8fafc;
      --panel:#ffffff;
      --panel2:#ffffff;
      --text:#0f172a;
      --muted:#64748b;

      --accent:#2563eb;
      --accent-soft: rgba(37,99,235,.14);

      --good:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;

      --border: rgba(15,23,42,.10);
      --gridline: rgba(15,23,42,.10);

      --shadow: 0 16px 34px rgba(2,6,23,.08);
      --radius: 16px;
    }

    body.theme-dark{
      --bg:#0f172a;
      --panel:#1e293b;
      --panel2:#16263a;
      --text:#f1f5f9;
      --muted:#94a3b8;

      --accent:#3b82f6;
      --accent-soft: rgba(59,130,246,.20);

      --good:#22c55e;
      --warn:#fbbf24;
      --bad:#f87171;

      --border: rgba(241,245,249,.10);
      --gridline: rgba(241,245,249,.10);

      --shadow: 0 18px 40px rgba(0,0,0,.35);
      --radius: 16px;
    }

    /* =========================
       Base
       ========================= */

    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      background: radial-gradient(1200px 600px at 10% 0%, rgba(37,99,235,.12), transparent 45%),
                  radial-gradient(1200px 600px at 90% 0%, rgba(245,158,11,.10), transparent 45%),
                  var(--bg);
      color:var(--text);
    }
    body.theme-dark{
      background: radial-gradient(1200px 600px at 10% 0%, rgba(59,130,246,.18), transparent 45%),
                  radial-gradient(1200px 600px at 90% 0%, rgba(251,191,36,.10), transparent 45%),
                  var(--bg);
    }

    .wrap{ max-width:1120px; margin:0 auto; padding:18px; }

    header{
      display:flex; gap:12px; justify-content:space-between; align-items:center; flex-wrap:wrap;
      margin-bottom:12px;
    }
    .brand{
      display:flex; flex-direction:column; gap:2px;
    }
    .brand h1{
      margin:0;
      font-size:18px;
      letter-spacing:.2px;
      display:flex; align-items:center; gap:10px;
    }
    .brand .sub{ color:var(--muted); font-size:12px; }

    .top-actions{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }

    .btn{
      appearance:none;
      border:1px solid var(--border);
      background: rgba(255,255,255,.70);
      color:var(--text);
      padding:9px 14px;
      border-radius:12px;
      cursor:pointer;
      font-weight:700;
      font-size:13px;
      transition: transform .15s ease, box-shadow .15s ease, filter .15s ease, background .15s ease;
      box-shadow: 0 8px 18px rgba(2,6,23,.06);
      backdrop-filter: blur(8px);
    }
    body.theme-dark .btn{
      background: rgba(30,41,59,.75);
      box-shadow: 0 10px 22px rgba(0,0,0,.35);
    }
    .btn:hover{ transform:translateY(-1px); }
    .btn:disabled{ opacity:.6; cursor:not-allowed; transform:none; }

    .btn.primary{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.05)), var(--accent);
      border-color: transparent;
      color:white;
    }
    .btn.primary:hover{ filter: brightness(1.04); }

    .btn.danger{
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.05)), var(--bad);
      border-color: transparent;
      color:white;
    }

    .btn.small{ padding:7px 10px; border-radius:10px; font-size:12px; box-shadow:none; }

    .tabs{
      display:flex; gap:8px; flex-wrap:wrap;
      margin:10px 0 14px;
    }
    .tab{
      padding:10px 12px;
      border-radius:12px;
      background: rgba(255,255,255,.55);
      border:1px solid var(--border);
      cursor:pointer;
      font-weight:800;
      font-size:13px;
      box-shadow: 0 10px 20px rgba(2,6,23,.06);
      backdrop-filter: blur(8px);
    }
    body.theme-dark .tab{
      background: rgba(30,41,59,.70);
      box-shadow: 0 12px 26px rgba(0,0,0,.35);
    }
    .tab.active{
      outline: 2px solid rgba(37,99,235,.25);
      outline-offset: 2px;
    }
    body.theme-dark .tab.active{
      outline-color: rgba(59,130,246,.30);
    }

    .hidden{ display:none !important; }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    @media (max-width: 980px){ .grid{ grid-template-columns:1fr; } }

    .card{
      background: rgba(255,255,255,.75);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
      backdrop-filter: blur(10px);
    }
    body.theme-dark .card{
      background: rgba(30,41,59,.78);
    }
    .card h2{ margin:0 0 10px; font-size:14px; letter-spacing:.2px; }
    .muted{ color:var(--muted); }

    /* KPI container (content rendered by JS) */
    #kpi{ display:block; }
    
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 11px;
      background: var(--accent-soft);
      border:1px solid rgba(0,0,0,.06);
      border-radius:999px;
      font-weight:800;
      font-size:12px;
      color: var(--text);
    }
    body.theme-dark .pill{
      border-color: rgba(255,255,255,.10);
    }

    .dot{ width:8px; height:8px; border-radius:999px; background:var(--accent); display:inline-block; }
    .pill.good{ background: rgba(22,163,74,.14); }
    .pill.good .dot{ background: var(--good); }
    .pill.warn{ background: rgba(245,158,11,.16); }
    .pill.warn .dot{ background: var(--warn); }
    .pill.bad{ background: rgba(239,68,68,.16); }
    .pill.bad .dot{ background: var(--bad); }

    /* micro animation KPI */
    @keyframes kpiBump {
      0%   { transform: translateY(0) scale(1); }
      35%  { transform: translateY(-1px) scale(1.02); }
      100% { transform: translateY(0) scale(1); }
    }
    .pill.bump{
      animation: kpiBump 420ms ease;
    }

    .wallet{
      background: rgba(255,255,255,.75);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
      backdrop-filter: blur(10px);
      transition: transform .15s ease, box-shadow .15s ease;
    }
    body.theme-dark .wallet{ background: rgba(30,41,59,.78); }
    .wallet:hover{ transform: translateY(-2px); }

    .wallet h3{ margin:0 0 6px; font-size:14px; }

    .bar{
      height:10px;
      border-radius:999px;
      background: rgba(2,6,23,.08);
      overflow:hidden;
      border:1px solid rgba(2,6,23,.08);
    }
    body.theme-dark .bar{
      background: rgba(241,245,249,.08);
      border-color: rgba(241,245,249,.10);
    }
    .bar > div{
      height:100%;
      background: linear-gradient(90deg, var(--accent), rgba(255,255,255,.20));
      border-radius:999px;
    }

    .day{
      background: rgba(255,255,255,.75);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow: var(--shadow);
      padding:12px;
      backdrop-filter: blur(10px);
    }
    body.theme-dark .day{ background: rgba(30,41,59,.78); }

    .day .top{ display:flex; justify-content:space-between; gap:10px; align-items:center; }
    .details{ margin-top:8px; color:var(--muted); font-size:12px; line-height:1.4; }

    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .field{
      display:flex; flex-direction:column; gap:6px;
      min-width:160px;
    }
    .field label{ font-size:12px; color:var(--muted); font-weight:800; letter-spacing:.2px; }

    input, select{
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.70);
      color:var(--text);
      outline:none;
      font-weight:750;
      box-shadow: 0 10px 20px rgba(2,6,23,.06);
      backdrop-filter: blur(8px);
    }
    body.theme-dark input, body.theme-dark select{
      background: rgba(30,41,59,.75);
      box-shadow: 0 12px 22px rgba(0,0,0,.35);
    }

    .tx{
      display:flex; justify-content:space-between; gap:12px;
      padding:12px;
      border-radius:16px;
      background: rgba(255,255,255,.70);
      border:1px solid var(--border);
      margin-bottom:10px;
      box-shadow: 0 14px 30px rgba(2,6,23,.06);
      backdrop-filter: blur(10px);
      transition: transform .15s ease;
    }
    body.theme-dark .tx{
      background: rgba(30,41,59,.78);
      box-shadow: 0 16px 34px rgba(0,0,0,.35);
    }
    .tx:hover{ transform: translateY(-1px); }

    .tx .meta{ color:var(--muted); font-size:12px; margin-top:2px; }
    .tags{ display:flex; gap:6px; flex-wrap:wrap; margin-top:6px; }
    .tag{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      background: rgba(2,6,23,.06);
      border:1px solid rgba(2,6,23,.08);
      color: var(--muted);
    }
    body.theme-dark .tag{
      background: rgba(241,245,249,.08);
      border-color: rgba(241,245,249,.10);
    }

    canvas{ width:100%; border-radius:14px; background: rgba(255,255,255,.55); border:1px solid var(--border); }
    body.theme-dark canvas{ background: rgba(15,23,42,.18); }

    .legendItem{ display:flex; align-items:center; gap:8px; color:var(--muted); font-size:12px; margin:6px 0; }
    .swatch{ width:10px; height:10px; border-radius:999px; display:inline-block; }

    /* Auth overlay */
    #auth-overlay{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      z-index:50;
    }
    .auth-box{
      max-width:420px;
      margin:12vh auto 0;
      background: rgba(255,255,255,.85);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow: var(--shadow);
      padding:16px;
      backdrop-filter: blur(12px);
    }
    body.theme-dark .auth-box{
      background: rgba(30,41,59,.85);
    }
    .auth-box h2{ margin:0 0 10px; font-size:16px; }
    .auth-msg{ color:var(--muted); font-size:12px; margin-bottom:10px; }

    /* Modal */
    #overlay{
      position:fixed; inset:0;
      background:rgba(0,0,0,.55);
      display:none;
      z-index:60;
    }
    #modal{
      position:fixed;
      left:50%; top:50%;
      transform:translate(-50%,-50%);
      width:min(520px, calc(100vw - 24px));
      background: rgba(255,255,255,.88);
      border:1px solid var(--border);
      border-radius:18px;
      box-shadow: var(--shadow);
      padding:16px;
      display:none;
      z-index:70;
      backdrop-filter: blur(12px);
    }
    body.theme-dark #modal{
      background: rgba(30,41,59,.88);
    }
    #modal h3{ margin:0 0 10px; font-size:16px; }
    .modal-grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    @media (max-width:560px){ .modal-grid{ grid-template-columns:1fr; } }
    .modal-actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:12px; flex-wrap:wrap; }

    /* Palette section */
    .palette-grid{
      display:grid;
      grid-template-columns: repeat(4, minmax(140px, 1fr));
      gap:10px;
      align-items:end;
    }
    @media (max-width: 980px){
      .palette-grid{ grid-template-columns:1fr 1fr; }
    }
    .colorchip{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.60);
      backdrop-filter: blur(10px);
      box-shadow: 0 12px 22px rgba(2,6,23,.06);
    }
    body.theme-dark .colorchip{
      background: rgba(30,41,59,.70);
      box-shadow: 0 14px 26px rgba(0,0,0,.35);
    }
    .chipdot{ width:14px; height:14px; border-radius:999px; }
  

    /* Restore native color picker (we use appearance:none globally) */
    input[type="color"]{
      -webkit-appearance: auto;
      appearance: auto;
      padding: 0;
      width: 40px;
      height: 28px;
      border: none;
      background: transparent;
      cursor: pointer;
    }
    input[type="color"]::-webkit-color-swatch-wrapper{ padding:0; }
    input[type="color"]::-webkit-color-swatch{ border:1px solid rgba(0,0,0,.15); border-radius:6px; }
    body.theme-dark input[type="color"]::-webkit-color-swatch{ border:1px solid rgba(255,255,255,.25); }




    /* Restore native color picker (we use appearance:none globally) */
    input[type="color"]{
      -webkit-appearance: auto;
      appearance: auto;
      padding: 0;
      width: 40px;
      height: 28px;
      border: none;
      background: transparent;
      cursor: pointer;
    }
    input[type="color"]::-webkit-color-swatch-wrapper{ padding:0; }
    input[type="color"]::-webkit-color-swatch{ border:1px solid rgba(0,0,0,.15); border-radius:6px; }
    body.theme-dark input[type="color"]::-webkit-color-swatch{ border:1px solid rgba(255,255,255,.25); }


/* Help tooltip icon */
.tb-help{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:16px;
  height:16px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.25);
  font-size:11px;
  line-height:1;
  margin-left:6px;
  cursor:help;
  opacity:.85;
  user-select:none;
}
.tb-help:hover{ opacity:1; }

    .lang-switch{display:inline-flex;gap:6px;align-items:center;margin-left:8px;}
    .btn-lang{padding:6px 10px;opacity:.75}
    .btn-lang.is-active{opacity:1;outline:2px solid rgba(255,255,255,.25)}


  /* Help / FAQ */
  #help-root .help-item { padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.08); }
  #help-root .help-item summary { cursor: pointer; font-weight: 600; }
  #help-root .help-answer { margin: 8px 0 4px; opacity: 0.95; }
  .help-result { padding: 10px; border: 1px solid rgba(255,255,255,0.10); border-radius: 10px; margin-bottom: 10px; }
  .help-q { font-weight: 700; margin-bottom: 6px; }
  .help-a { opacity: 0.95; }

  /* Assistant */
  .tb-assist-btn {
    position: fixed;
    right: 18px;
    bottom: 18px;
    z-index: 9999;
    width: 48px;
    height: 48px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(20,20,22,0.92);
    color: #fff;
    font-size: 20px;
    cursor: pointer;
    box-shadow: 0 10px 25px rgba(0,0,0,0.35);
  }
  .tb-assist-panel {
    position: fixed;
    right: 18px;
    bottom: 74px;
    z-index: 9999;
    width: min(360px, calc(100vw - 36px));
    max-height: min(520px, calc(100vh - 120px));
    overflow: hidden;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.16);
    background: rgba(18,18,20,0.96);
    color: #fff;
    box-shadow: 0 18px 38px rgba(0,0,0,0.45);
    display: flex;
    flex-direction: column;
  }
  .tb-assist-head { display:flex; align-items:center; justify-content:space-between; padding: 10px 12px; border-bottom: 1px solid rgba(255,255,255,0.10); }
  .tb-assist-title { font-weight: 800; }
  .tb-assist-actions { display:flex; align-items:center; gap: 10px; }
  .tb-assist-x { background: transparent; border: none; color: #fff; cursor: pointer; font-size: 16px; opacity: 0.9; }
  .tb-assist-link { background: transparent; border: none; color: #9cd6ff; cursor: pointer; font-size: 12px; text-decoration: underline; opacity: 0.95; }
  .tb-assist-body { padding: 10px 12px; overflow: auto; flex: 1; }
  .tb-assist-hint { opacity: 0.75; font-size: 12px; margin-bottom: 10px; }
  .tb-assist-thread { display:flex; flex-direction:column; gap: 8px; }
  .tb-assist-msg { padding: 8px 10px; border-radius: 12px; line-height: 1.25; white-space: pre-wrap; }
  .tb-assist-msg.user { align-self: flex-end; background: rgba(156,214,255,0.18); border: 1px solid rgba(156,214,255,0.25); }
  .tb-assist-msg.bot { align-self: flex-start; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.10); }
  .tb-assist-foot { padding: 10px 12px; border-top: 1px solid rgba(255,255,255,0.10); display:flex; gap: 8px; }
  .tb-assist-input { flex: 1; padding: 8px 10px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.14); background: rgba(0,0,0,0.18); color: #fff; outline: none; }
  .tb-assist-send { padding: 8px 10px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.14); background: rgba(255,255,255,0.10); color: #fff; cursor: pointer; }
</style>

</head>

<body class="theme-dark">
  <!-- Auth -->
  <div id="auth-overlay">
    <div class="auth-box">
      <h2>Connexion</h2>
      <div id="auth-msg" class="auth-msg">Connecte-toi pour synchroniser.</div>
      <div class="row" style="margin-bottom:10px;">
        <div class="field" style="flex:1;">
          <label>Email</label>
          <input id="auth-email" type="email" autocomplete="email" placeholder="you@email.com" />
        </div>
      </div>
      <div class="row" style="margin-bottom:12px;">
        <div class="field" style="flex:1;">
          <label>Mot de passe</label>
          <input id="auth-pass" type="password" autocomplete="current-password" />
        </div>
      </div>
      <div class="row" style="justify-content:flex-end;">
        <button class="btn" onclick="signUp()">Cr√©er compte</button>
        <button class="btn primary" onclick="signIn()">Se connecter</button>
      </div>
    </div>
  </div>

  <!-- Modal Tx -->
  <div id="overlay" onclick="closeModal()"></div>
  <div id="modal">
    <h3 id="modal-title">Nouvelle transaction</h3>
    <div id="m-lock-note" class="muted" style="display:none; margin:6px 0 10px;"></div>

    <div class="modal-grid">
      <div class="field">
        <label>Type <span class="tb-help" title="D√©pense = sort du wallet. Entr√©e = ajoute au wallet.">?</span></label>
        <select id="m-type">
          <option value="expense">D√©pense</option>
          <option value="income">Entr√©e</option>
        </select>
      </div>

      <div class="field">
        <label>Wallet <span class="tb-help" title="Le wallet concern√© par la transaction.">?</span></label>
        <select id="m-wallet"></select>
      </div>

      <div class="field">
        <label>Montant</label>
        <input id="m-amount" type="number" step="0.01" placeholder="0" />
      </div>

      <div class="field">
        <label>Cat√©gorie <span class="tb-help" title="Sert aux stats (camembert). Choisis 'Autre' si tu h√©sites.">?</span></label>
        <select id="m-category"></select>
      </div>

      <div class="field">
        <label>Date d√©but</label>
        <input id="m-start" type="date" />
      </div>

      <div class="field">
        <label>Date fin</label>
        <input id="m-end" type="date" />
      </div>

      <div class="field" style="grid-column:1/-1;">
        <label>Label</label>
        <input id="m-label" type="text" placeholder="Optionnel" />
      </div>

      <div class="field">
        <label>Pay√© maintenant <span class="tb-help" title="Coch√© : impact imm√©diat sur le solde. D√©coch√© : c'est √† payer/recevoir plus tard (pr√©vision).">?</span></label>
        <input id="m-paynow" type="checkbox" checked />
      </div>

      <div class="field">
        <label>Hors budget/jour <span class="tb-help" title="Coch√© : n'impacte pas le budget quotidien (ex: d√©pense exceptionnelle).">?</span></label>
        <input id="m-out" type="checkbox" />
      </div>

      <div class="field hidden" id="m-night-block">
        <label>Nuit couverte (Transport)</label>
        <input id="m-night" type="checkbox" />
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn" onclick="closeModal()">Annuler</button>
      <button id="m-resnap" class="btn" style="display:none" onclick="resnapshotModal()">‚Üª Re-snapshot</button>
      <button class="btn primary" onclick="saveModal()">Enregistrer</button>
    </div>
  </div>

  <!-- App -->
  <div id="app-root">
    <div class="wrap">
      <header>
        <div class="brand">
          <h1>Travel Budget</h1>
          <div class="sub">Outil de suivi de budget pendant tes voyages</div>
        </div>

        <div class="top-actions">
          <div class="lang-switch" title="Language">
            <button class="btn btn-lang" id="tbLangFr" type="button" data-lang="fr">FR</button>
            <button class="btn btn-lang" id="tbLangEn" type="button" data-lang="en">EN</button>
          </div>

          <button class="btn" onclick="toggleTheme()">üåì Theme</button>
          <button class="btn" onclick="refreshFxRates()">‚Üª Mettre √† jour les taux</button>
          <button class="btn" onclick="exportBackup()">‚¨á Export</button>
          <button class="btn" onclick="importBackup()">‚¨Ü Import</button>
          <button class="btn" onclick="signOut()">‚éã Logout</button>
        </div>
      </header>

      <div id="kpi" class="card"></div>
      <div id="solde-projection-container"></div>
      <div class="tabs">
        <div id="tab-dashboard" class="tab active" onclick="showView('dashboard')">Dashboard</div>
        <div id="tab-transactions" class="tab" onclick="showView('transactions')">Transactions</div>
        <div id="tab-settings" class="tab" onclick="showView('settings')">Settings</div>
        <div id="tab-help" class="tab" onclick="showView('help')" data-i18n="nav.help">Aide</div>
        <div id="tab-trip" class="tab" onclick="showView('trip')">Trip</div>
        <div id="tab-members" class="tab" style="display:none" onclick="showView('members')">Membres</div>
      </div>

      <!-- DASHBOARD -->
      <div id="view-dashboard">
        <div class="grid">
          <div class="card">
            <h2>Wallets</h2>
            <div id="onboarding-panel" class="card" style="display:none; margin:10px 0; border:1px dashed rgba(0,0,0,.25); background:rgba(0,0,0,.02);">
              <h3 style="margin:0 0 6px 0;">D√©marrer en 1 minute</h3>
              <div id="onboarding-panel-body" style="font-size:13px; line-height:1.35;"></div>
              <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
                <button class="btn primary" onclick="showView('settings')">Configurer</button>
                <button class="btn" onclick="hideOnboardingPanel()">Masquer</button>
              </div>
            </div>
            <div id="wallets-container" style="display:flex; flex-direction:column; gap:12px;"></div>
          </div>

          <div class="card">
            <h2>Budget journalier</h2>
            <div id="daily-budget-container" style="display:flex; flex-direction:column; gap:10px;"></div>
          </div>
        </div>

        <div class="grid" style="margin-top:12px;">
          <div class="card">
            <h2>Budget dispo (par jour)</h2>
            <canvas id="chart-budget"></canvas>
          </div>
          <div class="card">
            <h2>D√©penses par cat√©gorie</h2>
            <canvas id="chart-pie"></canvas>
            <div id="pie-legend" style="margin-top:10px;"></div>
          </div>
        </div>

        <!-- FULL WIDTH: Solde projection chart -->
        <div id="solde-projection-container" style="margin-top:16px;"></div>

      </div>

      <!-- TRANSACTIONS -->
      <div id="view-transactions" class="hidden">
        <div class="card" style="margin-bottom:12px;">
          <h2>Filtres</h2>
          <div class="row">
            <div class="field">
              <label>Du</label>
              <input id="f-from" type="date" />
            </div>
            <div class="field">
              <label>Au</label>
              <input id="f-to" type="date" />
            </div>
            <div class="field">
              <label>Wallet</label>
              <select id="f-wallet"></select>
            </div>
            <div class="field">
              <label>Cat√©gorie</label>
              <select id="f-category"></select>
            </div>
            <div class="field">
              <label>Type</label>
              <select id="f-type">
                <option value="all">Tous</option>
                <option value="expense">D√©penses</option>
                <option value="income">Entr√©es</option>
              </select>
            </div>

            <div class="field">
              <label>Payement</label>
              <select id="f-pay">
                <option value="all">Tous</option>
                <option value="paid">Pay√©s</option>
                <option value="unpaid">√Ä payer</option>
              </select>
            </div>

            <div class="field">
              <label>Hors budget</label>
              <select id="f-out">
                <option value="all">Tous</option>
                <option value="yes">Oui</option>
                <option value="no">Non</option>
              </select>
            </div>

            <div class="field">
              <label>Nuit couverte</label>
              <select id="f-night">
                <option value="all">Tous</option>
                <option value="yes">Oui</option>
                <option value="no">Non</option>
              </select>
            </div>

            <div class="field" style="min-width:220px;">
              <label>Recherche</label>
              <input id="f-q" type="text" placeholder="Label / cat√©gorie..." />
            </div>
          </div>
        </div>

        <div class="card">
          <h2>Liste</h2>
          <div id="tx-list"></div>
        </div>
      </div>

      <!-- SETTINGS -->
      <div id="view-settings" class="hidden">
        <div class="card" style="margin-bottom:12px;">
          <h2>Voyage</h2>

          <div class="row" style="margin-bottom:10px;">
            <div class="field">
              <label>Voyage actif</label>
              <select id="s-period"></select>
            </div><div class="field">
              <label>D√©but</label>
              <input id="s-start" type="date" />
            </div>

            <div class="field">
              <label>Fin</label>
              <input id="s-end" type="date" />
            </div></div>

          <div class="row" style="justify-content:flex-end;">
            <button class="btn" onclick="createVoyagePrompt()">+ Nouveau voyage</button>
            <button class="btn danger" onclick="deleteActiveVoyage()">Supprimer voyage</button>
            <button class="btn" onclick="createPeriodPrompt()">+ Ajouter p√©riode</button>
            <button class="btn primary" onclick="saveSettings()">Enregistrer dates</button>
          </div>
        </div>

        <div class="card" style="margin-bottom:12px;">
          <h2>P√©riodes du voyage</h2>
          <div class="muted" style="margin-bottom:10px;">
            Chaque p√©riode d√©finit une tranche de dates avec une devise + un budget/jour propres.
            Pour commencer : ajoute une p√©riode, puis ajuste les champs et enregistre.</div>

          <div id="seg-list"></div>
          <div id="manual-fx-box" style="margin-top:12px;"></div>
        </div>

        <div class="card">
          <h2>Palette</h2>
          <div class="muted" style="margin-bottom:10px;">
            Accent = boutons + highlights. Good/Warn/Bad = KPI + √©tats. Sauvegard√© en local (navigateur).
          </div>

          <div class="row" style="margin-bottom:10px;">
            <div class="field" style="min-width:220px;">
              <label>Preset</label>
              <select id="p-preset"></select>
            </div>
            <div class="field">
              <label></label>
              <button class="btn" onclick="resetPalette()">Reset</button>
            </div>
          </div>

          <div class="palette-grid">
            <div class="field">
              <label>Accent</label>
              <div class="colorchip">
                <span class="chipdot" id="chip-accent"></span>
                <input id="p-accent" type="color" />
              </div>
            </div>

            <div class="field">
              <label>Success</label>
              <div class="colorchip">
                <span class="chipdot" id="chip-good"></span>
                <input id="p-good" type="color" />
              </div>
            </div>

            <div class="field">
              <label>Warning</label>
              <div class="colorchip">
                <span class="chipdot" id="chip-warn"></span>
                <input id="p-warn" type="color" />
              </div>
            </div>

            <div class="field">
              <label>Danger</label>
              <div class="colorchip">
                <span class="chipdot" id="chip-bad"></span>
                <input id="p-bad" type="color" />
              </div>
            </div>
          </div>

          <div class="row" style="justify-content:flex-end; margin-top:12px;">
            <button class="btn primary" onclick="savePaletteFromUI()">Enregistrer palette</button>
          </div>
        </div>

        <div class="card" style="margin-bottom:12px;">
          <h2>Cat√©gories</h2>
          <div class="muted" style="margin-bottom:10px;">
            Les cat√©gories pilotent les listes c√¥t√© Budget + Trip. Elles sont sauvegard√©es sur Supabase.
          </div>

          <div class="row" style="gap:10px; align-items:flex-end; margin-bottom:12px;">
            <div class="field" style="min-width:220px;">
              <label>Nom</label>
              <input id="cat-name" type="text" placeholder="Ex: Sant√©" />
            </div>
            <div class="field" style="min-width:140px;">
              <label>Couleur</label>
              <input id="cat-color" type="color" value="#94a3b8" />
            </div>
            <button class="btn primary" onclick="addCategory()">+ Ajouter</button>
          </div>

          <div id="cat-list"></div>
        </div>

      </div>

      <!-- HELP / FAQ -->
      <div id="view-help" class="hidden">
        <div id="help-root" class="card">
          <h2 id="help-title" data-i18n="help.title">Aide & FAQ</h2>
          <div class="muted" id="help-subtitle" data-i18n="help.subtitle">R√©ponses rapides, exemples concrets, et mini-assistant.</div>

          <div class="form-row" style="margin-top:12px;">
            <label for="help-search" style="min-width:180px;" data-i18n="help.search_label">Recherche</label>
            <input id="help-search" type="text" style="flex:1;" />
          </div>

          <div id="help-empty" class="muted hidden" style="margin-top:10px;" data-i18n="help.no_results">Aucun r√©sultat.</div>
          <div id="help-results" style="margin-top:10px;"></div>

          <hr style="margin:16px 0; opacity:0.35;" />
          <div class="muted" style="margin-bottom:8px;">FAQ</div>
          <div id="help-list"></div>
        </div>
      </div>

      <!-- TRIP -->
      <div id="view-trip" class="hidden">
        <div id="trip-root"></div>
      </div>

      <!-- MEMBERS (ADMIN) -->
      <div id="view-members" class="hidden">
        <div id="members-root"></div>
      </div>

    </div>
  </div>

  <script type="module" src="/src/main.js"></script>
</body>
</html>
